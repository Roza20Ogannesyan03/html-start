class TypografLebedev{constructor(t={}){this.settings={enableRules:{quotes:!0,dashes:!0,spaces:!0,symbols:!0,punctuation:!0,math:!0,currency:!1,fractions:!0,initials:!0,email:!1,urls:!1},locale:"ru",htmlEntities:!1,liveUpdate:!0,exclude:["code","pre","script","style",".no-typograf",".code-block","[data-no-typograf]"],autoProcess:!0,delay:100},Object.assign(this.settings,t),this.rules=[],this.processedElements=new Set,this.initRules(),this.settings.autoProcess&&this.initAutoProcess()}initRules(){this.rules=[{name:"quotes-ru",enabled:()=>this.settings.enableRules.quotes&&"ru"===this.settings.locale,pattern:/(^|\s|\()"([^"]+)"(\)|\s|$|\.|,|\?|!|:)/g,replacement:"$1«$2»$3"},{name:"dash-em",enabled:()=>this.settings.enableRules.dashes,pattern:/(\s|^|\(|\[)-(\s|$|\)|\]|\.|,)/g,replacement:"$1—$2"},{name:"dash-between-spaces",enabled:()=>this.settings.enableRules.dashes,pattern:/(\d\s?)-(\s?\d)/g,replacement:"$1—$2"},{name:"dash-interval",enabled:()=>this.settings.enableRules.dashes,pattern:/(\d)(\s*)-(\s*)(\d)/g,replacement:"$1—$4"},{name:"ellipsis",enabled:()=>this.settings.enableRules.punctuation,pattern:/\.{3,}/g,replacement:"…"},{name:"nbsp-before-units",enabled:()=>this.settings.enableRules.spaces,pattern:/(\d)\s*(кг|г|мг|л|мл|см|мм|м|км|сек|мин|ч|сут|гр)(?![а-яё])/gi,replacement:"$1&nbsp;$2"},{name:"copyright",enabled:()=>this.settings.enableRules.symbols,pattern:/\((c|с)\)/gi,replacement:"©"},{name:"nbsp-before-short-words-fixed",enabled:()=>this.settings.enableRules.spaces,pattern:/(\s)([а-яё]{1,2})(?=\s+[а-яё])/gi,replacement:"$1$2&nbsp;"},{name:"nbsp-initials",enabled:()=>this.settings.enableRules.spaces&&this.settings.enableRules.initials,pattern:/([А-ЯЁА-ЯЁ])\.\s*([А-ЯЁА-ЯЁ])\./g,replacement:"$1.&nbsp;$2."},{name:"space-before-punctuation",enabled:()=>this.settings.enableRules.punctuation,pattern:/\s+([.,!?;:])/g,replacement:"$1"},{name:"space-after-punctuation",enabled:()=>this.settings.enableRules.punctuation,pattern:/([.,!?;:])([А-ЯЁA-Z])/g,replacement:"$1 $2"},{name:"fraction-1-2",enabled:()=>this.settings.enableRules.fractions,pattern:/(\s|^)1\/2(\s|$|\.|,)/g,replacement:"$1½$2"},{name:"fraction-1-4",enabled:()=>this.settings.enableRules.fractions,pattern:/(\s|^)1\/4(\s|$|\.|,)/g,replacement:"$1¼$2"},{name:"fraction-3-4",enabled:()=>this.settings.enableRules.fractions,pattern:/(\s|^)3\/4(\s|$|\.|,)/g,replacement:"$1¾$2"}]}shouldExclude(t){if(!t||!t.tagName)return!0;const e=t.tagName.toLowerCase();if(this.settings.exclude.includes(e))return!0;for(const e of this.settings.exclude)if(e.startsWith(".")&&t.matches&&t.matches(e)||e.startsWith("[")&&t.matches&&t.matches(e))return!0;return!1}process(t){if("string"!=typeof t)return t;let e=t;return this.rules.forEach(t=>{t.enabled()&&(e=e.replace(t.pattern,t.replacement))}),e}processElement(t){if(!t||this.processedElements.has(t)||this.shouldExclude(t))return;let e=!1;const r=o=>{if(o.nodeType===Node.TEXT_NODE&&o.textContent.trim()){const t=this.process(o.textContent);if(t!==o.textContent){o.textContent=t,e=!0}}else if(o.nodeType===Node.ELEMENT_NODE&&!this.shouldExclude(o))for(let t=0;t<o.childNodes.length;t++)r(o.childNodes[t])};r(t),e&&(t.setAttribute("data-typograf-processed","true"),this.processedElements.add(t))}initAutoProcess(){const t=()=>{this.processAll()};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",t):setTimeout(t,this.settings.delay)}processAll(){if(!document.body)return;const t=["p","h1","h2","h3","h4","h5","h6","div","span","li","td","th","article","section","main","footer","header","blockquote","figcaption"];t.forEach(t=>{document.querySelectorAll(t).forEach(e=>{this.processElement(e)})})}manualProcess(t){document.querySelectorAll&&document.querySelectorAll(t).forEach(t=>{this.processElement(t)})}}"undefined"!=typeof window&&(window.TypografLebedev=TypografLebedev,document.addEventListener("DOMContentLoaded",()=>{window.typografInstance||(window.typografInstance=new TypografLebedev)}),setTimeout(()=>{window.typografInstance||(window.typografInstance=new TypografLebedev)},500)),"undefined"!=typeof module&&module.exports&&(module.exports=TypografLebedev);